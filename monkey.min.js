var gl,startWebGL=function(){function h(a){try{gl=a.getContext("webgl"),gl.vbo={},gl.ibo={},gl.tex={},gl.attrib={},gl.uniform={},gl.viewportWidth=a.width,gl.viewportHeight=a.height}catch(e){}gl||console.error("Could not initialise WebGL")}function k(a,e,f){function c(){function b(b){c++;jx.load(b.src,function(e){a[b.name]=e;c--;0===c&&f()},b.type)}var c=0;numItems=d.length;for(var e=0;e<numItems;e++)b(d[e])}var d=[];(function(){jx.load(e,function(b){d=b;c()},"json")})()}res={};var l=function(){function a(e,
a){var c,d=e;if("frag"===a)c=gl.createShader(gl.FRAGMENT_SHADER);else if("vert"===a)c=gl.createShader(gl.VERTEX_SHADER),d=res.vertSource;else return console.error("unrecognised shader script type"),null;gl.shaderSource(c,d);gl.compileShader(c);return gl.getShaderParameter(c,gl.COMPILE_STATUS)?c:(console.error(gl.getShaderInfoLog(c)),null)}return function(e,f){var c=a(e,"vert"),d=a(f,"frag"),b=gl.createProgram();gl.attachShader(b,c);gl.attachShader(b,d);gl.linkProgram(b);gl.getProgramParameter(b,gl.LINK_STATUS)||
console.error("Could not initalise shaders");gl.useProgram(b);gl.attrib.vertPos=gl.getAttribLocation(b,"aVertPos");gl.attrib.norm=gl.getAttribLocation(b,"aNorm");gl.enableVertexAttribArray(gl.attrib.vertPos);gl.enableVertexAttribArray(gl.attrib.norm);gl.uniform.PVMatrix=gl.getUniformLocation(b,"uPVMatrix");gl.uniform.MMatrix=gl.getUniformLocation(b,"uMMatrix");gl.uniform.NMatrix=gl.getUniformLocation(b,"uNMatrix");c=mat4.create();d=mat4.create();mat4.perspective(d,45,gl.viewportWidth/gl.viewportHeight,
.1,100);mat4.translate(c,c,[0,0,-4]);b=mat3.create();mat3.normalFromMat4(b,c);gl.uniformMatrix4fv(gl.uniform.PVMatrix,!1,d);gl.uniformMatrix4fv(gl.uniform.MMatrix,!1,c);gl.uniformMatrix3fv(gl.uniform.NMatrix,!1,b)}}(),g=function(){angle=timeThen=0;return function(){requestAnimFrame(g);timeNow=(new Date).getTime();0!==timeThen&&(deltaT=timeNow-timeThen,angle+=Math.PI/2/1E3*deltaT,angle%=2*Math.PI);timeThen=timeNow;var a=mat4.create(),e=mat3.create();mat4.translate(a,a,[0,0,-4]);mat4.rotateY(a,a,angle);
mat3.normalFromMat4(e,a);gl.uniformMatrix4fv(gl.uniform.MMatrix,!1,a);gl.uniformMatrix3fv(gl.uniform.NMatrix,!1,e);gl.viewport(0,0,gl.viewportWidth,gl.viewportHeight);gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT);gl.bindBuffer(gl.ARRAY_BUFFER,gl.vbo.monkeyVerticies);gl.vertexAttribPointer(gl.attrib.vertPos,gl.vbo.monkeyVerticies.itemSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ARRAY_BUFFER,gl.vbo.monkeyNorms);gl.vertexAttribPointer(gl.attrib.norm,gl.vbo.monkeyNorms.itemSize,gl.FLOAT,!1,0,0);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,
gl.ibo.monkeyTris);gl.drawElements(gl.TRIANGLES,gl.ibo.monkeyTris.numItems,gl.UNSIGNED_SHORT,0)}}();return function(a){a=document.getElementById(a);h(a);k(res,"res.json",function(){l(res.vertSource,res.fragSource);for(var a=res.objMonkey,f=a.vertIndex.length,c=[],d=0;d<f;d++)for(var b=0;3>b;b++)c[3*a.vertIndex[d]+b]=a.norms[3*a.normIndex[d]+b];a.normIndex=null;a.norms=c;gl.vbo.monkeyVerticies=gl.createBuffer();gl.vbo.monkeyVerticies.itemSize=3;gl.vbo.monkeyVerticies.numItems=res.objMonkey.verts.length/
3;gl.bindBuffer(gl.ARRAY_BUFFER,gl.vbo.monkeyVerticies);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(res.objMonkey.verts),gl.STATIC_DRAW);gl.vbo.monkeyNorms=gl.createBuffer();gl.vbo.monkeyNorms.itemSize=3;gl.vbo.monkeyNorms.numItems=gl.vbo.monkeyVerticies.numItems;gl.bindBuffer(gl.ARRAY_BUFFER,gl.vbo.monkeyNorms);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(res.objMonkey.norms),gl.STATIC_DRAW);gl.ibo.monkeyTris=gl.createBuffer();gl.ibo.monkeyTris.itemSize=1;gl.ibo.monkeyTris.numItems=res.objMonkey.vertIndex.length;
gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,gl.ibo.monkeyTris);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(res.objMonkey.vertIndex),gl.STATIC_DRAW);gl.bindBuffer(gl.ARRAY_BUFFER,null);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,null);gl.clearColor(0,0,0,1);gl.enable(gl.DEPTH_TEST);g()})}}();
